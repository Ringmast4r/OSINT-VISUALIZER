<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OSINT Visualizer Demo (Mock Only)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#f7f7fb;--fg:#0f172a;--muted:#64748b;--card:#fff;--border:#e2e8f0;--accent:#111827}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);
      font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:#0f172a;color:#fff;
      display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:20px} .sub{color:var(--muted);font-size:13px;margin-top:2px}
    .row{display:flex;gap:8px;margin:14px 0}
    input[type="text"]{flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:10px}
    button{background:var(--accent);color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;background:#fff;cursor:pointer}
    .chip.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px}
    .item{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}
    .item a{color:inherit;text-decoration:none} .title{font-weight:600;margin-bottom:6px}
    .subtle{font-size:12px;color:var(--muted)} .note{margin-top:10px;color:#a15c00;background:#fff7e6;border:1px solid #ffe1b3;padding:8px;border-radius:10px;font-size:13px}
    canvas{width:100%;height:260px !important;background:#fff;border:1px solid var(--border);border-radius:12px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">OS</div>
      <div>
        <h1>OSINT Visualizer Demo</h1>
        <div class="sub">Mock data only · works fully on GitHub Pages</div>
      </div>
    </div>

    <div class="row">
      <input id="q" placeholder="Search term (e.g., mark zuckerberg)" />
      <button id="btn">Search</button>
    </div>

    <div class="card" style="margin-bottom:12px">
      <div class="chips" id="chips"></div>
      <div id="stats" class="subtle" style="margin-top:8px"></div>
      <div style="margin-top:12px"><canvas id="chart"></canvas></div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><strong>Results</strong></div>
        <div class="subtle">Grouped by source · newest first</div>
      </div>
      <div id="results"></div>
    </div>
  </div>

<script>
/* ===================== MOCK DEMO ===================== */
const SOURCES = ["NewsAPI","GovInfo","IPinfo","FEC"];
let active = new Set(SOURCES);
let data = [];

const chipsEl   = document.getElementById('chips');
const resultsEl = document.getElementById('results');
const statsEl   = document.getElementById('stats');
const qEl       = document.getElementById('q');
const btnEl     = document.getElementById('btn');

SOURCES.forEach((s) => {
  const b = document.createElement('button');
  b.className = 'chip active';
  b.textContent = s;
  b.onclick = () => {
    if (active.has(s)) { active.delete(s); b.classList.remove('active'); }
    else { active.add(s); b.classList.add('active'); }
    render();
  };
  chipsEl.appendChild(b);
});

btnEl.onclick = runSearch;
qEl.addEventListener('keydown', (e) => (e.key === 'Enter') && runSearch());

function mockItems(q, source, n = 5) {
  const now = Date.now();
  return Array.from({length:n}).map((_,i) => ({
    id: `${source}-mock-${i}`,
    title: `${source} result ${i+1}: ${q || 'sample'}`,
    url: "https://example.com",
    summary: `Demo ${source} record related to “${q || 'query'}”.`,
    source,
    confidence: 0.6 + Math.random()*0.3,
    severity: Math.floor(Math.random()*100),
    timestamp: new Date(now - Math.random()*8640000).toISOString(),
  }));
}

async function runSearch() {
  const q = qEl.value.trim() || "demo";
  data = Array.from(active).flatMap(s => mockItems(q, s, s === "IPinfo" ? 3 : 5));
  render();
}

function fmtDate(iso) {
  const d = new Date(iso);
  return isNaN(+d) ? "" : d.toLocaleString();
}

function aggregate(items) {
  const m = new Map();
  for (const it of items) {
    const k = it.source;
    if (!m.has(k)) m.set(k, {source:k,hits:0,conf:0});
    const r = m.get(k);
    r.hits++; r.conf += (it.confidence||0);
  }
  return Array.from(m.values()).map(r => ({
    source:r.source,
    hits:r.hits,
    avgConf:r.conf / r.hits
  }));
}

let chart;
function drawChart(aggs) {
  const ctx = document.getElementById('chart').getContext('2d');
  const labels = aggs.map(a => a.source);
  const hits   = aggs.map(a => a.hits);
  const conf   = aggs.map(a => Math.round((a.avgConf||0)*100));
  const dataCfg = {
    labels,
    datasets: [
      { label:'Hits', data:hits, type:'bar', backgroundColor:'#0ea5e9' },
      { label:'Avg Confidence %', data:conf, type:'line', yAxisID:'y1', borderColor:'#111827' }
    ]
  };
  const options = {
    responsive:true,
    scales:{ y:{beginAtZero:true}, y1:{beginAtZero:true,position:'right',max:100} }
  };
  if (chart) chart.destroy();
  chart = new Chart(ctx,{data:dataCfg,options});
}

function render() {
  const filtered = data.filter(d => active.has(d.source));
  const aggs = aggregate(filtered);
  drawChart(aggs);
  statsEl.textContent = `Total hits: ${filtered.length} · Active sources: ${active.size}`;

  if (!filtered.length) {
    resultsEl.innerHTML = `<div class="subtle">No results (toggle sources or search again).</div>`;
    return;
  }
  const m = new Map();
  for (const it of filtered) {
    if (!m.has(it.source)) m.set(it.source,[]);
    m.get(it.source).push(it);
  }
  let html = '';
  for (const [src, arr] of m.entries()) {
    html += `<div style="margin:10px 0"><div class="subtle"><strong>${src}</strong> (${arr.length})</div><div class="grid">`;
    for (const it of arr) {
      html += `<div class="item"><a href="${it.url}" target="_blank">
        <div class="title">${it.title}</div>
        <div class="subtle">${it.summary}</div>
        <div class="subtle">${fmtDate(it.timestamp)} · conf ${Math.round((it.confidence||0)*100)}%</div>
      </a></div>`;
    }
    html += `</div></div>`;
  }
  resultsEl.innerHTML = html;
}

// Run demo on load
runSearch();
</script>
</body>
</html>
