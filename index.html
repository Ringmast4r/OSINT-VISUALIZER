<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>OSINT Visualizer (Mock Demo)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#f7f7fb;--fg:#0f172a;--muted:#64748b;--card:#fff;--border:#e2e8f0;--accent:#111827}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .header{position:sticky;top:0;background:rgba(255,255,255,.8);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  .brand{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px}
  .logo{width:40px;height:40px;border-radius:12px;background:#0f172a;color:#fff;display:flex;align-items:center;justify-content:center}
  h1{margin:0;font-size:20px} .sub{color:var(--muted);font-size:13px;margin-top:2px}
  .wrap{max-width:1200px;margin:16px auto;padding:0 16px}
  .row{display:flex;gap:8px;margin:10px 0 16px}
  input[type="text"]{flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:10px}
  button{background:var(--accent);color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
  .grid{display:grid;grid-template-columns:1fr 2fr;gap:16px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;min-height:34px}
  .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;background:#fff;cursor:pointer;box-shadow:0 0 0 2px transparent inset;transition:box-shadow .15s}
  .chip.active{color:#fff}
  .chip .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
  .toolbar{display:flex;gap:10px;margin-top:8px}
  .toolbar a{font-size:13px}
  .muted{color:var(--muted)}
  .canvasWrap{height:380px;border:1px solid var(--border);border-radius:16px;display:flex;align-items:center;justify-content:center;background:#fff}
  canvas{width:100%;height:100%}
  .listMetrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:12px}
  .metric{border:1px solid var(--border);border-radius:12px;padding:10px;background:#fff}
  .metric .k{font-weight:700;font-size:20px}
  .resultsHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .groups{display:flex;flex-direction:column;gap:14px}
  .groupTitle{display:flex;align-items:center;gap:8px;font-weight:600}
  .legendDot{width:10px;height:10px;border-radius:999px;display:inline-block}
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px}
  .item{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}
  .item a{color:inherit;text-decoration:none}
  .item .title{font-weight:600;margin-bottom:6px}
  .item .subtle{font-size:12px;color:var(--muted)}
  .note{margin-top:10px;color:#a15c00;background:#fff7e6;border:1px solid #ffe1b3;padding:8px;border-radius:10px;font-size:13px}
</style>
</head>
<body>
  <div class="header">
    <div class="brand">
      <div class="logo">OS</div>
      <div>
        <h1>OSINT Visualizer</h1>
        <div class="sub">OSINT API Search · radial source aggregation (mock demo)</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="row">
      <input id="q" placeholder="Type a name/company/keyword… then press Search" />
      <button id="btn">Search</button>
    </div>

    <div id="note" class="note" style="display:none"></div>

    <div class="grid">
      <!-- Sources / counts -->
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 4h18l-7 8v6l-4 2v-8L3 4z" stroke="#0f172a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <strong>Sources</strong>
        </div>
        <div id="chips" class="chips"></div>
        <div class="toolbar">
          <a href="#" id="selectAll">Select all</a>
          <a href="#" id="clearAll">Clear</a>
        </div>
        <div class="muted" style="margin-top:10px">
          Total hits: <strong id="hits">0</strong><br/>
          Active sources: <strong id="activeCount">0</strong>
        </div>
      </div>

      <!-- Spires/metrics -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <strong>Source Spires</strong>
          <div class="muted">Height = hits · Arc = avg confidence · Color per source</div>
        </div>
        <div class="canvasWrap">
          <canvas id="spireCanvas"></canvas>
        </div>
        <div id="metrics" class="listMetrics"></div>
      </div>
    </div>

    <!-- Results -->
    <div class="card" style="margin-top:16px">
      <div class="resultsHead">
        <strong>Results</strong>
        <div class="muted">Grouped by source · newest first</div>
      </div>
      <div id="groups" class="groups"></div>
    </div>
  </div>

<script>
// ---------- CONFIG (palette + source list) ----------
const PALETTE = {
  FEC:"#2563eb", GovInfo:"#16a34a", OpenCorporates:"#f59e0b",
  EPA:"#dc2626", "SAM.gov":"#7c3aed", FCC:"#0ea5e9",
  CollegeScorecard:"#059669", unknown:"#9ca3af"
};
const SOURCES = ["FEC","GovInfo","OpenCorporates","EPA","SAM.gov","FCC","CollegeScorecard"];

// ---------- STATE ----------
let active = new Set(SOURCES); // start with all ON
let data = [];

// ---------- DOM ----------
const chipsEl = document.getElementById("chips");
const hitsEl  = document.getElementById("hits");
const activeCountEl = document.getElementById("activeCount");
const metricsEl = document.getElementById("metrics");
const groupsEl  = document.getElementById("groups");
const qEl       = document.getElementById("q");
const btnEl     = document.getElementById("btn");
const noteEl    = document.getElementById("note");
const canvas    = document.getElementById("spireCanvas");
const ctx       = canvas.getContext("2d");

// ---------- UTIL ----------
function showNote(msg){ noteEl.style.display = msg ? "block":"none"; noteEl.textContent = msg || ""; }
function fmtPct(x){ return `${Math.round((x||0)*100)}%`; }
function fmtInt(x){ return new Intl.NumberFormat().format(x||0); }
function fmtDate(iso){ const d=new Date(iso); return isNaN(+d)?"":d.toLocaleString(); }
function escapeHtml(s){return String(s||'').replace(/[&<>"]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]))}

// ---------- CHIPS ----------
function buildChips(){
  chipsEl.innerHTML = "";
  SOURCES.forEach((s)=>{
    const b = document.createElement("button");
    b.className = "chip active";
    b.style.boxShadow = `0 0 0 2px ${PALETTE[s]} inset`;
    b.style.background = PALETTE[s];
    b.style.color = "#fff";
    b.dataset.source = s;
    b.innerHTML = `<span class="dot" style="background:${PALETTE[s]}"></span>${s}`;
    b.onclick = () => {
      if (active.has(s)) {
        active.delete(s);
        b.classList.remove("active");
        b.style.color=""; b.style.background="#fff";
      } else {
        active.add(s);
        b.classList.add("active");
        b.style.color="#fff"; b.style.background=PALETTE[s];
      }
      render();
    };
    chipsEl.appendChild(b);
  });
  document.getElementById("selectAll").onclick = (e)=>{e.preventDefault(); active = new Set(SOURCES); buildChips(); render();};
  document.getElementById("clearAll").onclick  = (e)=>{e.preventDefault(); active = new Set(); buildChips(); render();};
}

// ---------- MOCK DATA ----------
function mockItems(q, source, nMin=3, nMax=9){
  const n = nMin + Math.floor(Math.random()*(nMax-nMin+1));
  const now = Date.now();
  const out = [];
  for (let i=0;i<n;i++){
    out.push({
      id:`${source}-${i}-${Math.random().toString(36).slice(2,7)}`,
      title:`${source} match ${i+1} · ${q || 'sample'}`,
      url:"https://example.com/item",
      summary:`Synthetic preview text for “${q || 'query'}” from ${source}.`,
      source,
      confidence:0.55 + Math.random()*0.4,  // 0.55..0.95
      severity:Math.floor(Math.random()*100),
      timestamp:new Date(now - Math.random()*86_400_000*14).toISOString()
    });
  }
  return out;
}

// ---------- AGG ----------
function aggregateBySource(items){
  const m = new Map();
  for (const it of items){
    const k = it.source || "unknown";
    if (!m.has(k)) m.set(k,{source:k,hits:0,confSum:0});
    const r = m.get(k);
    r.hits += 1;
    r.confSum += (it.confidence || 0);
  }
  const arr = Array.from(m.values()).map(r=>({
    source:r.source,
    hits:r.hits,
    avgConfidence:r.confSum / Math.max(1,r.hits),
    color:PALETTE[r.source] || PALETTE.unknown
  }));
  arr.sort((a,b)=>b.hits - a.hits);
  return arr;
}
function groupBySource(items){
  const m = new Map();
  for (const it of items){
    const k = it.source || "unknown";
    if (!m.has(k)) m.set(k,[]);
    m.get(k).push(it);
  }
  for (const [k,arr] of m.entries()){
    arr.sort((a,b)=> (new Date(b.timestamp||0)) - (new Date(a.timestamp||0)));
    m.set(k,arr);
  }
  return Array.from(m.entries());
}

// ---------- SPIRES (canvas) ----------
function drawSpires(aggs){
  const dpr = window.devicePixelRatio || 1;
  const w = canvas.clientWidth || canvas.parentElement.clientWidth;
  const h = canvas.clientHeight || 380;
  canvas.width  = w * dpr; canvas.height = h * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.clearRect(0,0,w,h);

  const cx = w/2, cy = h/2 + 20;
  const ringGap = 22;
  const baseR   = 28;

  // background rings
  ctx.strokeStyle = "#e5e7eb";
  for (let r=baseR; r< Math.min(w,h)/2 - 8; r+=ringGap){
    ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.lineWidth = 1; ctx.stroke();
  }

  aggs.forEach((a, idx)=>{
    const r = baseR + idx*ringGap;
    const lw = Math.min(6 + a.hits, 32);
    const angle = (a.avgConfidence || 0) * Math.PI*2;
    const start = -Math.PI/2;
    ctx.beginPath();
    ctx.arc(cx,cy,r,start,start + Math.max(angle, Math.PI*0.08));
    ctx.strokeStyle = a.color;
    ctx.lineCap = "round";
    ctx.lineWidth = lw;
    ctx.stroke();
  });
}

// ---------- RENDER ----------
function render(){
  const filtered = data.filter(d=>active.has(d.source));
  const aggs = aggregateBySource(filtered);
  hitsEl.textContent = fmtInt(filtered.length);
  activeCountEl.textContent = active.size;

  // metrics
  metricsEl.innerHTML = aggs.map(a=>`
    <div class="metric">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <span class="muted">${a.source}</span>
        <span class="legendDot" style="background:${a.color}"></span>
      </div>
      <div class="k">${fmtInt(a.hits)}</div>
      <div class="muted">avg conf ${fmtPct(a.avgConfidence)}</div>
    </div>
  `).join("");

  drawSpires(aggs);

  const groups = groupBySource(filtered);
  groupsEl.innerHTML = groups.map(([src,arr])=>{
    const color = PALETTE[src] || PALETTE.unknown;
    const cards = arr.map(it=>`
      <div class="item">
        <a href="${it.url}" target="_blank" rel="noreferrer">
          <div class="title">${escapeHtml(it.title)}</div>
          <div class="subtle" style="margin:6px 0">${escapeHtml(it.summary)}</div>
          <div class="subtle">${src} · conf ${fmtPct(it.confidence)} · ${fmtDate(it.timestamp)}</div>
        </a>
      </div>
    `).join("");
    return `
      <div>
        <div class="groupTitle">
          <span class="legendDot" style="background:${color}"></span>
          ${src} <span class="muted">(${arr.length})</span>
        </div>
        <div class="cards">${cards}</div>
      </div>
    `;
  }).join("") || `<div class="muted">No results yet. Toggle sources or run a search.</div>`;
}

// ---------- SEARCH (mock only) ----------
function runSearch(){
  const q = qEl.value.trim();
  if (!q){
    showNote("Type something to search, then press Search.");
    return;
  }
  showNote("");
  if (active.size === 0){
    showNote("No sources selected. Click ‘Select all’ or enable some sources.");
    return;
  }
  // Build mock results per active source
  let out = [];
  active.forEach(s => { out = out.concat(mockItems(q,s)); });
  data = out;
  render();
}

// ---------- INIT ----------
function init(){
  buildChips();         // create chips and wire handlers
  qEl.value = "";       // start empty
  render();             // render empty state
  btnEl.onclick = runSearch;
  qEl.addEventListener("keydown",(e)=> e.key==="Enter" && runSearch());
}
init();
</script>
</body>
</html>
